<!-- search.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Search stays ‚Äì AirHost&ShortStay</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="manifest" href="manifest.json">
    <style>
        /* same global styles as index, plus split layout specifics */
        * { margin:0; padding:0; box-sizing:border-box; }
        body { background:#0f172a; color:#fff; }
        .sticky-header, .nav-menu, .global-footer { /* reuse from index */ }
        /* split layout: left 70%, right 30% */
        .search-layout { display:flex; height:calc(100vh - 150px); } /* adjust for header/nav */
        .left-main { width:70%; display:flex; background:#0f172a; }
        .filters-sidebar { width:220px; background:#0a0f1a; padding:1.5rem 1rem; overflow-y:auto; border-right:1px solid #1e293b; }
        .listings-grid { flex:1; padding:1rem; overflow-y:auto; background:#0f172a; }
        .map-panel { width:350px; background:#1e293b; position:relative; }
        .property-preview { width:30%; background:#0a0f1a; border-left:2px solid #f59e0b; padding:1rem; overflow-y:auto; }
        .filter-group { margin-bottom:1.5rem; }
        .slider-amber { width:100%; accent-color:#f59e0b; }
        .tier-badges span, .amenities span { background:#1e293b; padding:0.3rem 0.8rem; border-radius:40px; display:inline-block; margin:0.2rem; cursor:pointer; }
        .btn-apply { background:#f59e0b; color:#0f172a; border:none; padding:0.7rem; width:100%; border-radius:40px; font-weight:bold; margin-top:1rem; }
        .grid-cards { display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:1rem; margin-top:1rem; }
        .listing-card-enhanced { background:#1e293b; border-radius:24px; padding:1rem; transition:0.2s; border:1px solid transparent; }
        .listing-card-enhanced:hover { border-color:#f59e0b; transform:translateY(-4px); box-shadow:0 10px 20px #00000080; }
        .preview-placeholder { display:flex; align-items:center; justify-content:center; height:100%; color:#64748b; }
        .map-controls { position:absolute; top:10px; right:10px; display:flex; gap:0.5rem; }
        .map-controls button { background:#0f172a; color:#fff; border:1px solid #f59e0b; border-radius:40px; padding:0.4rem 0.8rem; cursor:pointer; }
        /* incentive badges */
        .bonus-chip { background:#10b98120; color:#10b981; border-radius:40px; padding:0.2rem 0.8rem; font-size:0.8rem; }
        /* mobile mockup same as index */
        .mobile-mockup { position:fixed; bottom:20px; left:20px; width:200px; z-index:2000; }
        /* ensure responsiveness */
        @media (max-width:1000px) { .left-main { flex-direction:column; } .map-panel { width:100%; height:300px; } }
    </style>
</head>
<body>
    <header class="sticky-header">... (same as index) ...</header>
    <nav class="nav-menu">... (same) ...</nav>

    <div class="search-layout">
        <div class="left-main">
            <!-- Filters sidebar -->
            <aside class="filters-sidebar">
                <h4>Filter by</h4>
                <div class="filter-group">
                    <label>Price ($0‚Äì1000)</label>
                    <input type="range" min="0" max="1000" value="500" class="slider-amber" id="price-range">
                </div>
                <div class="filter-group">
                    <label>Incentive Score</label>
                    <select id="incentive-score-filter">
                        <option value="0">Any</option>
                        <option value="85">85+</option>
                        <option value="90">90+</option>
                    </select>
                </div>
                <div class="filter-group tier-badges">
                    <span data-tier="Silver">Silver</span>
                    <span data-tier="Gold">Gold</span>
                    <span data-tier="Diamond">Diamond</span>
                </div>
                <div class="filter-group amenities">
                    <span data-amenity="airchef">üçΩÔ∏è AirChef</span>
                    <span data-amenity="airride">üöó AirRide</span>
                    <span data-amenity="airrelax">üßò AirRelax</span>
                </div>
                <div class="filter-group">
                    <label>Radius <span id="radius-display">20 km</span></label>
                    <input type="range" min="1" max="100" value="20" id="radius-filter" class="slider-amber">
                </div>
                <button class="btn-clear" id="clear-filters" style="background:transparent; border:1px solid #f59e0b; color:#fff; padding:0.5rem; width:100%; border-radius:40px;">Clear all</button>
                <button class="btn-apply" id="apply-filters">Apply filters</button>
                <div class="social-side" style="margin-top:2rem; display:flex; gap:1rem;">
                    <a href="#">ùïè</a><a href="#">üì∑</a><a href="#">üëç</a><a href="#" class="wishlist-icon">‚ù§Ô∏è</a>
                </div>
            </aside>

            <!-- Listings grid -->
            <section class="listings-grid">
                <div class="hot-homes-carousel" style="display:flex; gap:1rem; overflow-x:auto; padding-bottom:1rem;">
                    <div class="carousel-card" style="background:#1e293b; padding:1rem; border-radius:20px;">‚è≥ 3 left ¬∑ Villa Rosa</div>
                    <div class="carousel-card" style="background:#1e293b; padding:1rem;">‚è≥ 5 left ¬∑ The Penthouse</div>
                </div>
                <div class="grid-header" style="display:flex; justify-content:space-between;">
                    <span>342 stays</span>
                    <select id="sort-select">
                        <option>Recommended</option>
                        <option>Price low</option>
                        <option>Incentive score</option>
                    </select>
                </div>
                <div class="grid-cards" id="search-grid-cards"></div>
            </section>

            <!-- Map panel -->
            <aside class="map-panel">
                <div id="search-map" style="height:100%; width:100%;"></div>
                <div class="map-controls">
                    <button id="recenter-btn">üìç</button>
                    <button id="fullscreen-btn">‚õ∂</button>
                </div>
            </aside>
        </div>

        <!-- Right preview panel -->
        <aside class="property-preview" id="property-preview">
            <div class="preview-placeholder">
                <p>Select a property to preview</p>
            </div>
        </aside>
    </div>

    <footer class="global-footer">... (same) ...</footer>
    <div class="mobile-mockup">... (same) ...</div>
    <div class="dash-assistant">ü§ñ</div>

    <script>
        const listings = [ /* same mock data extended */ 
            { id:1, title:'Sunset Beach Villa', price:180, lat:-1.286, lng:36.817, incentiveScore:92, bonusValue:45, cashback:'10%', tier:'Diamond', guests:4, region:'Nairobi', amenities:['airchef'] },
            { id:2, title:'Penthouse Langata', price:250, lat:-1.332, lng:36.722, incentiveScore:88, bonusValue:60, cashback:'5%', tier:'Gold', amenities:['airride'] },
            { id:3, title:'Pool House Kilimani', price:150, lat:-1.292, lng:36.785, incentiveScore:76, bonusValue:30, tier:'Silver' },
            { id:4, title:'Villa Mombasa', price:320, lat:-4.043, lng:39.668, incentiveScore:95, bonusValue:80, cashback:'15%', tier:'Diamond', amenities:['airchef','airrelax'] },
        ];

        // map
        const map = L.map('search-map').setView([-1.286,36.817], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        // markers
        listings.forEach(l => {
            let color = l.tier==='Diamond'?'#a855f7': l.tier==='Gold'?'#f59e0b':'#10b981';
            const m = L.marker([l.lat, l.lng], { icon: L.divIcon({ html:`<div style="background:${color};color:#000;border-radius:20px;padding:4px 8px;">$${l.price}</div>` }) }).addTo(map);
            m.on('click', () => updatePreview(l));
        });

        // render listing cards
        function renderListings(filtered=listings) {
            const grid = document.getElementById('search-grid-cards');
            grid.innerHTML = '';
            filtered.forEach(l => {
                grid.innerHTML += `
                    <div class="listing-card-enhanced" data-id="${l.id}">
                        <img src="https://picsum.photos/300/200?random=${l.id}" style="width:100%; border-radius:16px;">
                        <div style="display:flex; justify-content:space-between; margin-top:0.5rem;">
                            <span>${l.title}</span>
                            <span class="badge ${l.tier.toLowerCase()}">${l.tier}</span>
                        </div>
                        <div><strong>$${l.price}</strong> <span class="bonus-chip">+$${l.bonusValue}</span></div>
                        <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                            ${l.cashback?`<span class="badge green">${l.cashback} cashback</span>`:''}
                            <span class="badge amber">Score ${l.incentiveScore}</span>
                        </div>
                        <div style="margin-top:0.5rem;">
                            <input type="checkbox" class="compare-checkbox" value="${l.id}"> Compare
                            <span class="wishlist-icon" style="float:right;">‚ù§Ô∏è</span>
                        </div>
                    </div>
                `;
            });
            // attach click to cards to update preview
            document.querySelectorAll('.listing-card-enhanced').forEach(card => {
                card.addEventListener('click', (e) => {
                    if(e.target.tagName==='INPUT' || e.target.classList.contains('wishlist-icon')) return;
                    const id = card.dataset.id;
                    const listing = listings.find(l=>l.id==id);
                    updatePreview(listing);
                });
            });
        }

        function updatePreview(listing) {
            const preview = document.getElementById('property-preview');
            preview.innerHTML = `
                <div class="preview-content">
                    <h3>${listing.title}</h3>
                    <div style="display:flex; gap:0.5rem; flex-wrap:wrap;">
                        <span class="badge amber">‚≠ê Incentive ${listing.incentiveScore}</span>
                        <span class="badge green">‚úÖ Verified</span>
                    </div>
                    <img src="https://picsum.photos/400/300?random=${listing.id}" style="width:100%; border-radius:16px; margin:1rem 0;">
                    <p><strong>$${listing.price}</strong> per night ¬∑ +$${listing.bonusValue} bonus</p>
                    <button class="lipa-btn" onclick="alert('Lipa Mdogo Mdogo: 4 installments')">Lipa Mdogo</button>
                    <button style="background:#f59e0b; border:none; padding:0.5rem 1rem; border-radius:40px;">Negotiate</button>
                    <div style="margin-top:1rem;">
                        <span>AirChef üçΩÔ∏è</span> <span>AirRide üöó</span> <span>AirRelax üßò</span>
                    </div>
                </div>
            `;
        }

        renderListings();

        // filters mock
        document.getElementById('apply-filters').addEventListener('click', ()=>{
            // just simulate filter by incentive >85
            const filtered = listings.filter(l => l.incentiveScore >= 85);
            renderListings(filtered);
            // update map (in real would re-marker)
        });

        // wishlist (localStorage)
        let wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
        document.addEventListener('click', (e)=>{
            if(e.target.classList.contains('wishlist-icon')) {
                const id = e.target.closest('[data-id]')?.dataset.id;
                if(id && !wishlist.includes(id)) wishlist.push(id);
                localStorage.setItem('wishlist', JSON.stringify(wishlist));
                alert('Added to wishlist');
            }
        });
    </script>
    <script>if ('serviceWorker' in navigator) navigator.serviceWorker.register('service-worker.js');</script>
</body>
</html>